<!DOCTYPE html>
{% load static %}
<html>
    <head>

<meta name="viewport" content="width=device-width" />

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
        <link rel="icon" type="image/png" href="/static/favicon.png" />
        <title>{{settings.title}}</title>
        <meta name="description" content="{{settings.meta_description}}"/>
        <meta name="keywords" content="{{settings.keywords}}"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" type="text/css" href="static/sf-webfont.css">
        <link href="static/open-iconic/font/css/open-iconic-bootstrap.css" rel="stylesheet">
        <link href="static/js/jquery-typeahead/src/jquery.typeahead.css" rel="stylesheet">
        <script src="static/js/jquery-typeahead/src/jquery.typeahead.js"></script>

        <!--
        -->

        <script src="/static/js/notify.js"></script>
        <script src="/static/nicescroll/jquery.nicescroll.js"></script>
        <script src="https://api-maps.yandex.ru/1.1/index.xml" type="text/javascript"></script>




    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

    <!--
          <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

        <link rel="stylesheet" type="text/css" href="static/css.css" >
        <link rel="stylesheet" type="text/css" href="static/mobile.css" >

	<meta name="yandex-verification" content="54883a35452f8514" />
        <script>
function isTouchDevice(){
    return true == ("ontouchstart" in window || window.DocumentTouch && document instanceof DocumentTouch);
}

            window.BASE_COST={{settings.cost}};
           function formDate(day) {
                if (!day) day = 0;
                var date = new Date(new Date().getTime() + 24*60*60*1000*day);
                return((date.getDate()) + '.' +(date.getMonth() + 1))+ '.' +  date.getFullYear()
            }



        $(document).ready(function() {
		if (false && !isTouchDevice()) {
		$("#shops-list").niceScroll({
			'autohidemode':false,
			'touchbehaviour':true
		});
		$('#float-city-selector .right').niceScroll({
			'autohidemode':false,
			'touchbehaviour':true
});
} else {

		$("#shops-list").addClass('overflow');
		$('#float-city-selector .right').addClass('overflow');
}
        });
        </script>
        <script>
        window.cities = {
        {% for c in cities %}
            '{{c.name}}':{
                'x':'{{c.x}}',
                'y':'{{c.y}}',
                'target':'{{c.target}}',
                'name':'{{c.name}}',
                'delivery':'{{c.has_delivery}}',
                'shops':[{% for s in c.shops.all %}
                   {
                       'name':'{{s.name}}',
                       'x':'{{s.x}}',
                       'y':'{{s.y}}',
                       'title':'{{s.title}}',
                       'phone':'{{s.phone}}'
                   },
                {% endfor %}
                ]
        },
        {% endfor %}
        };
        </script>
    </head>
    <body id="mobile" class="mobile">
        <div id="right-border">
        </div>
        <div id="left-border">
        </div>

      <style>
        .mobile .navbar {
          border-bottom: 5px solid #ee5c72;
        }
        .mobile .navbar-light .navbar-toggler-icon {
          background-image: url("/static/navbar.png");
        }
        .mobile .navbar-light .navbar-toggler {
          border-color:transparent;
        }
      </style>
<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">
                    <img src="static/./logo.png" id="logo"></a>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">

                    {% for page in pages|dictsort:"order" %}
                        {% if page.menu_title %}
      <li class="nav-item">
        <a class="nav-link" href="#{{page.slug}}">{{page.menu_title|title}}</a>
      </li>
                        {% endif %}
                    {% endfor %}
    </ul>
  </div>
</nav>

<!--
        <div id="head">
            <span id="menu">
                <ul>
                    <li><a href="#"><img src="static/./logo.png" id="logo"></a></li>
                    {% for page in pages|dictsort:"order" %}
                        {% if page.menu_title %}
                            <li><a href="#{{page.slug}}">{{page.menu_title}}</a></li>
                        {% endif %}
                    {% endfor %}
                    <li class="nowrap">
                        <span onclick="$('.float-city-selector').show();" class="select-city">
                           <span style="color:#2c4f8a">▼</span>
                           <a href="#"><span class="selector">Москва</span></a>
                        </span>
                    </li>
                </ul>
                <img
                 style="position:absolute; right:0px; top:-7px; x-width:190px;"
                 src="{{ settings.phone.url }}" />
            </span>
        </div>
      -->


        <script type="text/javascript">
           function choose_shop(shop, index) {
                map.streetView.setVisible(false);
                var x = toDot(shop.x);
                var y = toDot(shop.y);
                var name = shop.name;
                var title = shop.title;
                var phone = shop.phone;
                if (window.map_marker !=null) {

                }
                var position = {lat:x,lng:y};
                map.panTo(position);
                map.setZoom(17);

                infowindow.open(map, map_marker[index]);
                map.panTo(mpos);
           }

           function choose_city(city) {

               //if (typeof {{settings.yandex_counter_id}} != 'undefined') {
               //     {{settings.yandex_counter_id}}.reachGoal(cities[city].target);
               //}


               $('.city_name').html(city);
               $('input.input.city').val(city);
                var x = cities[city].x;
                var y = cities[city].y;

                window.lc.setItem("ChosenName", city);

                $('.float-city-selector').hide();
                $('.select-city .selector').text(city);

                var items = '';
                if (cities[city].delivery == 'True') {
                    $('.delivery.free').show();
                    $('.delivery.non-free').hide();
                } else {
                    $('.delivery.free').hide();
                    $('.delivery.non-free').show();
                }

                map.streetView.setVisible(false);
                map.setZoom(7);
                map.panTo({lat:toDot(x),lng:toDot(y)});

                if (typeof map_marker == 'undefined' || map_marker == null) var map_marker = [];
                for (var k = 0; k<map_marker.length; k++) {
                    map_marker[k].setMap(null);
                }
                map_marker = [];

                var shops = cities[city].shops.sort(function(a,b) {
                    if (a.name<b.name) {
                        return -1;
                    } else if (a.name>b.name) {
                        return 1;
                    }
                    return 0;
                } );
                $('#shops-list').html('');
                for (var i =0; i<shops.length; i++) {

                    let shop = shops[i];
                    let position = {lat:toDot(shop.x),lng:toDot(shop.y)};
                    //map.panTo(position);
                    map_marker.push(new google.maps.Marker({
                        position: position,
                        map: map,
                        title: shop.name+' '
                    }));

                    let infowindow = new google.maps.InfoWindow({
                        content: "<div><h2 style='color:#47bae8;'>"+shop.title+"</h2>"
                        +"<div>"+shop.name+"</br>"+shop.phone+"</div></div>"
                    });
                    let index = map_marker.length-1;
                    let x = toDot(shop.x);
                    let y = toDot(shop.y);
                    let mpos = {lat:x, lng:y};

                    map_marker[map_marker.length-1].addListener('click', function() {
                        infowindow.open(map, map_marker[index]);
                        map.panTo(mpos);
                    });


                    var item=$('<li style="cursor:pointer;" onclick="{{settings.yandex_counter_id}}.reachGoal(\''+cities[city].target+'\');  choose_shop(cities[\''+city+'\'].shops['+i+'],'+i+')">'+shops[i].name+'</li>');
                    item.click(function() {
                        infowindow.open(map, map_marker[index]);
                        map.panTo(mpos);

                    });
                    items+=item;
                    $('#shops-list').append(item);
                }
           }
        </script>
        <div  class="bg order-done" style=""> </div>
        <div class="order-done" id="order-done">
        <div onclick="$('.order-done').hide();" style="position:fixed; width:100%; height:100%; z-index:0; left:0px; top:0px; cursor:pointer;"></div>
                <script>
                    window.order_form = {
                        count:1,
                        base_cost:580,
                        cost:580,
                        plus:function() {
                            this.count++;
                            this.update();
                        },
                        minus:function() {
                            this.count--;
                            this.update();
                        },
                        init:function() {
                            this.city='';
                            this.street='';
                            this.house='';
                            this.flat='';
                            this.time='';
                            this.count='1';
                            this.total='0';
                            this.name='';
                            this.phone='';
                            this.email='';
                            this.count=1;
                            $('#order-done input:not(.city)').val('');
                            $('#order-done textarea:not(.city)').html('');
                            this.update();
                        },
                        step1:function(next) {
                            if (next)  {
                                $('.step1 input').removeClass('error');
                                var error = false;

                                this.name = $('.step1 .name').val();
                                this.phone = $('.step1 .phone').val();
                                this.phone = this.phone.replace(/[^0-9()\- ]/g,'');


                                if (!this.name) {
                                    $('.step1 .name').addClass('error');
                                    error = true;
                                }
                                if (!this.phone || this.phone.length<6) {
                                    $('.step1 .phone').addClass('error');
                                    error = true;
                                }

                                this.email = $('.step1 .email').val();
                                if (!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.email)) {
                                        $('.step1 .email').addClass('error');
                                        error = true;
                                }

                                if (!error) {
                                    $('.step1').hide();
                                    $('.step2').show();
                                }


                            } else {
                                $('.order-done').hide();

                            }
                        },
                        step2:function(next) {
                            if (next)  {
                                $('.step2 input').removeClass('error');
                                var error = false;
                                this.city = $('.step2 .city').val();
                                this.street = $('.step2 .street').val();
                                this.house = $('.step2 .house').val();
                                this.flat = $('.step2 .flat').val();
                                if (!this.city) {
                                    $('.step2 .city').addClass('error');
                                    error = true;
                                }
                                if (!this.street) {
                                    $('.step2 .street').addClass('error');
                                    error = true;
                                }
                                if (!this.house) {
                                    $('.step2 .house').addClass('error');
                                    error = true;
                                }
                                if (!this.flat) {
                                    $('.step2 .flat').addClass('error');
                                    error = true;
                                }


                                if (!error) {

                    {{settings.yandex_counter_id}}.reachGoal('OrderComplete');
				    this.date = '';
				    this.time = '';
				    $.post('/order/',{
					    city:   this.city,
					    street: this.street,
					    house:  this.house,
					    flat:   this.flat,
					    time:   this.time,
					    date:   this.date,
					    phone:  this.phone,
					    time:   this.time,
					    name:   this.name,
					    phone:  this.phone,
					    email:  this.email,
					    count:  this.count,
					    total:  this.total
				    }).fail(function(d) {
					$('#order-done .error').show();
					$.notify("При выполнении запроса произошла ошибка","error");
					//$('.order-done .step1').show();
					//$('.order-done .step3').hide();
				    }).done(function(d){
					$('.order-done .step1').show();
					$('.order-done .step2').hide();
					$.notify("Запрос успешно отправлен","success");
					$('.order-done').hide();
					this.init();
				    });
				}

                            } else {
                                    $('.step2').hide();
                                    $('.step1').show();

                            }


                        },
                        step3: function(next) {
                            if(!next) {
                                $('.order-done .step2').show();
                                $('.order-done .step3').hide();
                                return;
                            }

                            $('#order-done .error').hide();

                            var error = false;
                            this.date =  formDate(parseInt($('.step3 .date .active').attr('alt')));
                            this.time  = $('.step3 .time').val();
                            //this.count = $('#order-done .holder .quantity').val();
                            this.total = this.count*BASE_COST;
                            if (!this.time || !this.date) {
                                error = true;
                            }

                            if (error) {
                                $('#order-done .error').show();
                                $('#order-done .error').html('Необходимо заполнить все поля');
                                return;
                            }
                        },
                        update: function() {
                            if (!this.count) {
                                this.count=1;
                            }
                            //this.count = $('.step3 .count').val();
                            this.cost = window.BASE_COST * this.count;
                            $('#order-done .quantity').html(this.count);
                            $('#order-done .cost span.q').html(this.cost);
                        }
                    };
                    order_form.init();

                </script>
                <div class="inner">
                    <img src="static/akto-box-photo.png" />
                    <div class="holder">
                        <div class="left">
                            <span class="title">
                                <!--
                                -->
                            {{settings.form_title}}
                            </span>
                            <br/>
                            <span class="cost">
                                <span><script>document.write(BASE_COST);</script></span>₽
                            </span>
                            <br/>
                            <span class="count">
                                <a onclick="order_form.minus();" class="minus">
                                    -
                                </a>
                                <span>
                                    <span class="quantity">1</span> уп.
                                </span>
                                <a onclick="order_form.plus();" class="plus">
                                    +
                                </a>
                            </span>
                            <br/>
                            <span class="total">
                                Итого: <span class="cost"><span class="q"><script>document.write(BASE_COST);</script></span> руб.</span>
                            </span>
                            <span class="info">
                                {{settings.const_info}}
                            </span>
                        </div>
                        <div class="right step2" style="display:none;">
                            <h4>
                                <!--
                                -->
                                {{settings.form_header_1}}
                            </h4>
                            <div class="form">
                            <hr />
                            <br/>
                            <br/>
                            <script type="text/javascript">
                                function appendClear(val) {
                                    $('.city_list_holder').html('');
                                    $('#order-done input.city').val(val);
                                    choose_city(val);
                                }

function ahead(val) {
    if (val.length<=1) {
        return '';
    }
    result = '';
    var cities = Object.keys(window.cities);
    for (var i = 0; i<cities.length; i++) {
        if (cities[i].toLowerCase().indexOf(val.toLowerCase())!=-1) {
            result+="<li onclick='appendClear($(this).html())'>"+cities[i]+"</li>";
        }
    }
    result="<ul>"+result+"</ul>"
    $('.city_list_holder').html(result);
    return result;
}
                            </script>
                            <input  class="input city" name="city" onkeyup="ahead($(this).val())" type="text" placeholder="Населенный пункт" />
                            <div class="city_list_holder">
                            </div>
                            <br/>
                            <input  class="street" name="time" type="text" placeholder="Улица" />
                            <br/>
                            <input  class="house" name="house" type="text" placeholder="Дом" />
                            <input  class="flat" name="flat" type="text" placeholder="Квартира" />
                            <br />
                            <div style="color:red; margin:20px; display:none;" class="error"></div>
                            <br/>
                            <a onclick="order_form.step2(false);" href="javascript:void(0);">Отменить</a>
                            <a onclick="order_form.step2(true); " href="javascript:void(0);">Отправить</a>
                            </div>
                        </div>
                        <div class="right step1">
                            <h4>
                                <!--
                                -->
                                {{settings.form_header_2}}
                            </h4>
                            <div class="form">
                            <hr />
                            <input  class="name" name="name" type="text" placeholder="{{settings.name_caption}}*" />
                            <br/>
                            <input  class="phone" name="phone" type="text" placeholder="{{settings.phone_caption}}*" />
                            <br/>
                            <input  class="email" name="email" type="text" placeholder="{{settings.mail_caption}}" />
                            <div>
                            * - Поля, обязательные для заполнения
                            </div>
                            <br/>
                            <br/>
                            <br/>
                            <div style="color:red; margin:20px; display:none;" class="error"></div>
                            <a onclick="order_form.step1(false);" href="javascript:void(0);">Отменить</a>
                            <a onclick="order_form.step1(true);" href="javascript:void(0);">Далее</a>
                            </div>

                        </div>
                        <div class="right step3" style="display:none;">
                            <h4 style="">
                                <!--
                                -->
                                {{settings.form_header_3}}
                                <br/>
                                <br/>
</h4>
                            <span style="
                            display:block;
                            padding-right:40px;
    x-max-width: 600px;
    x-position: relative;
    x-height: 200px;
    x-padding-top: 10px!important;
    x-display: inline-block;
    ">
                                {{settings.order_complete|linebreaksbr}}

</span>
                            <div class="form">
                                <div class="when date">
                                    <a style="width:159px;" alt="0" onclick="$('.form .date a').removeClass('active'); $(this).addClass('active');"
                                     href="javascript:void(0);">Сегодня</a>
                                    <a  style="width:113px;" alt="1" onclick="$('.form .date a').removeClass('active'); $(this).addClass('active');" href="javascript:void(0);">Завтра</a>
                                    <a  style="width:174px;" alt="2" onclick="$('.form .date a').removeClass('active'); $(this).addClass('active');" href="javascript:void(0);">Послезавтра</a>
                                </div>
                            <input  class="time" name="time" type="text" placeholder="Укажите время" />
                            <div style="color:red; margin:20px; display:none;" class="error"></div>
                            <br/>
                            <a style="width:225px;" onclick="order_form.step3(false);" href="javascript:void(0);">Назад</a>
                            <a style="width:225px;" onclick="order_form.step3(true);"  href="javascript:void(0);">Подтвердить</a>
                            </div>

                        </div>
                    </div>
                </div>
        </div>

        <div class="float-city-selector bg" style="">
        </div>
        <div class="float-city-selector" id="float-city-selector">
                <div class="holder">
                    <div class="left">
                            <img src="static/akto-box-photo.png" />
                    </div>
                    <div class="right">
                        <div class="title">
                            Ваш регион: <span class="city_name">Москва
                            </span>
                            <br />
                            <br />
                            Выберите ваш регион из списка, если мы определили его неправильно
                        </div>
                        <div class="city-list">
                            {% for city in cities %}
                                <span onclick="choose_city('{{city.name}}');" >
                                    {{ city.name }}
                                </span>
                            {% endfor %}
                        </div>
                        </div>
                    </div>
		    <div class="clear"></div>
                </div>
        </div>
        <div class="clear"></div>
        {% for page in pages|dictsort:"order" %}
        <a name="{{page.slug}}" class="{{page.slug}} anchor"> <!--{{page.template}}--> </a>
            {% include page.template %}
        {% endfor %}


        <script>


try {
  window.lc = localStorage;
  localStorage.setItem('test','test');
} catch(e) {
  var lc = function() {
    this.data = {};
    this.setItem =  function(k,v) {this.data[k]=v;}
    this.getItem =  function(k) { return this.data[k];}
  }
  window.lc = new lc();
}


            switchGal = function(obj) {
                var el = $(obj);
                if (!$(el).parent().hasClass('active')) {
                    $(el).parent().parent().find('.active').removeClass('active');
                    $(el).parent().addClass('active')
                }

            }
            $('#page-faq .list li h5').click(function(){
                switchGal(this);
                //console.log(this);
            });
            $('#page-faq .list li').first().addClass('active');
        </script>
        <script type="text/javascript">

            /*
                if (navigator.geolocation) {
                          navigator.geolocation.getCurrentPosition(function(position) {
                            var pos = {
                              lat: position.coords.latitude,
                              lng: position.coords.longitude
                            };

                            infoWindow.setPosition(pos);
                            infoWindow.setContent('Location found.');
                            map.setCenter(pos);
                          }, function() {
                            handleLocationError(true, infoWindow, map.getCenter());
                          });
                        } else {
                          // Browser doesn't support Geolocation
                          //handleLocationError(false, infoWindow, map.getCenter());
                        }
*/
         function showForm() {
             $('.order-done').show();

         }

        function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
var csrftoken = getCookie('csrftoken');
function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});

        </script>
    <script>
$('.float-city-selector.bg').click(function() {
    $('.float-city-selector').hide();
});

$('#order-done').click(function(e) {
      if (e.target !== this)
        return;
    $('.order-done').hide();
});

$('.order-done.bg').click(function() {
    $('.order-done').hide();
});
        $(window).scroll(function(){
            $('#head').css('margin-left',-parseInt($(window).scrollLeft()));
            $('#float-city-selector').css('margin-left',-parseInt($(window).scrollLeft()));
            $('#float-city-selector').css('top',parseInt($(window).scrollTop()));
            $('#oranggal').css('margin-left',-parseInt($(window).scrollLeft()));
        });


    </script>
    <script>

    </script>
    {{settings.counters|safe}}

<script type="text/javascript">
  $('body').ready(function(){
       var carousels = $('.carousel');
    carousels.each(function(i,carousel) {
      let max = 0;
      var items = $(carousel).find('.carousel-item');
      items.each(function(k,item) {
           if ($(item).height() > max) {
          max = $(item).height();
        }
      });
      max+=10;
      $(carousel).first('.carousel-inner').height(max);

      items.each(function(k,item) {
           $(item).height(max);
      });
    });
  });

 openYandex = function() {
   setTimeout(function () { window.location = "https://www.facebook.com"; }, 25);
   window.location = "fb://";
 }


</script>
    </body>
</html>
